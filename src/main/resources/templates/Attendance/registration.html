<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>出勤管理</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link th:href="@{/CSS/create.css}" rel="stylesheet" />
<!--<script>-->
<!--	function showPopup() {-->
<!--		alert("登録が完了しました！");-->
<!--	}-->
<!--</script>-->
</head>
<body>
	
	<div class="container" th:object="${Users}">
		<div class="row">
			<form id="mainForm" th:action="@{/attendance/management}" method="post" th:object="${attendanceFormList}">
				<div class ="row">
					<div class="col-5 ">
						ユーザー名:<span th:text="${Users.userName}"></span>
						<input type="hidden" name="userName" th:value="${Users.userName}">
					</div>
					<div class="col-4">
						ユーザーID:<span th:text="${Users.userId}"></span>
						<input type="hidden" name="userId" th:value="${Users.userId}">
					</div>
					<th:block th:if="${Users.status} == null">
						<div class="col-3">
							ステータス　
						</div>
					</th:block>
					<th:block th:if="${Users.status} == 1">
						<div class="col-3">
							ステータス　承認待ち
						</div>
					</th:block>
					<th:block th:if="${Users.status} == 2">
						<div class="col-3">
							ステータス　承認済み
						</div>
					</th:block>
					<th:block th:if="${Users.status} == 3">
						<div class="col-3">
							ステータス　却下
						</div>
					</th:block>
					<th:block th:if="${Users.status} == 4">
						<div class="col-3">
							ステータス　未申請
						</div>
					</th:block>
					
				</div>
 
				<div class="row">
					<div class="text-danger" th:if="${check} != null">
						<span th:text="${check}" style="color: red;"></span>
					</div>
					<div class="col-6" th:if="${Users.role} == 'Regular' or ${Users.role} == 'UnitManager'">
						表示年月：
						<input type="text" id="years" name="years" >
						<label for="years">年</label>
						<input type="text" id="month" name="month">
						<label for="month">月</label>
						<input type="submit" id="display" value="表示" name="search" class="buttonSize">
					</div>
					<div class="text-danger" th:if="${double} != null">
						<span th:text="${double}" style="color: red;"></span>
					</div>
					<div class="col-6">
						<div th:if="${Users.role} == 'Manager'">
							<input type="submit" id="reject" value="却下" name="Rejected"class="buttonSize">
							<input type="submit" id="approve" value="承認" name="approval"class="buttonSize">
							</div>
						<div th:unless="${Users.role} == 'Manager'">
							<span th:if="${Users.RequestActivityCheck} == false">
								<input type="submit" id="requestApproval" name="approvalApplicationRegistration" value="承認申請" class="buttonSize" disabled>
							</span>
							<span th:if="${Users.RequestActivityCheck} == true">
								<input type="submit" id="requestApproval" name="approvalApplicationRegistration" value="承認申請" class="buttonSize">
							</span>
							<input type="submit" id="register" value="登録" name="insert" class="buttonSize">
						</div>
					</div>
				</div>
				
				<div th:if="${ApprovalPending} != null">
					<div class="col-7" th:each="ApprovalPending : ${ApprovalPending}">
						<table class="table table-bordered border border-dark ">
							<thead>
								<tr>
									<td>承認申請者</td>
									<td>申請対象年月</td>
									<td>申請日</td>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th:block>
											<input type="hidden" name="approvalUserId" th:value="${ApprovalPending.userId}">
											<input type="hidden" name="Years" th:value="${ApprovalPending.years}">
											<input type="hidden" name="Month" th:value="${ApprovalPending.month}">
									</th:block>
									<td>
										<input type="submit" name="ApprovalApplicantDisplay" th:value ="${ApprovalPending.userName}"class="linklike" >
									</td>
									<td th:text="${#dates.format(ApprovalPending.targetYearMonth,'yyyy/MM/dd')}"></td>
									<td th:text="${#dates.format(ApprovalPending.monthlyAttendanceReqDate,'yyyy/MM/dd')}"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				
				<div th:if="${attendanceFormList} != null">
					<div class="row m-5">
						<div class="col-12 ml-3" th:each="attendance, start : ${attendanceFormList.attendanceList}">
							
							
							
							
							
							<table class="table table-bordered border border-dark">
								<thead>
									<tr>
										<th>日付</th>
										<th>曜日</th>
										<th>勤務状況</th>
										<th>出勤時間</th>
										<th>退勤時間</th>
										<th>備考</th>
									</tr>
								</thead>
								<tbody>
									<th:block th:if="${(Users.role == 'Regular' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'UnitManager' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'Manager')}">
										<tr>
											<th:block>
												<input type="hidden" th:name="|attendanceList[${start.index}].userId|" th:value="${attendance.userId}">
												<input type="hidden" th:name="|attendanceList[${start.index}].dayOfWeek|" th:value="${attendance.dayOfWeek}">
												<input type="hidden" th:name="|attendanceList[${start.index}].attendanceDateS|" th:value="${attendance.attendanceDateS}">
											</th:block>
											<td th:text="${#dates.format(attendance.attendanceDate, 'MM/dd')}"></td>
	<!--										<td th:text="${attendance.attendanceDateS}"></td>-->
											<td th:text="${attendance.dayOfWeek}"></td>
											<td>
												<select id="status" th:field="*{attendanceList[__${start.index}__].status}" class="noneBox">
													<option value="12" th:selected="${attendance.status} == '0'" disabled>選択してください</option>
													<option th:value="0" th:selected="${attendance.status} == '0'" disabled>通常出勤</option>
													<option th:value="1" th:selected="${attendance.status} == '1'" disabled>休日</option>
													<option th:value="2" th:selected="${attendance.status} == '2'" disabled>祝日</option>
													<option th:value="3" th:selected="${attendance.status} == '3'" disabled>遅刻</option>
													<option th:value="4" th:selected="${attendance.status} == '4'" disabled>有給</option>
													<option th:value="5" th:selected="${attendance.status} == '5'" disabled>欠勤</option>
													<option th:value="6" th:selected="${attendance.status} == '6'" disabled>早退</option>
													<option th:value="7" th:selected="${attendance.status} == '7'" disabled>時間外勤務</option>
													<option th:value="8" th:selected="${attendance.status} == '8'" disabled>振替出勤</option>
													<option th:value="9" th:selected="${attendance.status} == '9'" disabled>振替休日</option>
													<option th:value="10" th:selected="${attendance.status} == '10'" disabled>代替出勤</option>
													<option th:value="11" th:selected="${attendance.status} == '11'" disabled>代替休日</option>
												</select>
											</td>
											<td><input type="text" id="startTime" th:field="*{attendanceList[__${start.index}__].startTime}" th:value="${attendance.startTime}" class="noneBox" readonly></td>
											<td><input type="text" id="endTime" th:field="*{attendanceList[__${start.index}__].endTime}" th:value="${attendance.endTime}" class="noneBox" readonly></td>
											<td><input type="text" id="attendanceRemarks" th:field="*{attendanceList[__${start.index}__].attendanceRemarks}" th:value="${attendance.attendanceRemarks}" class="noneBox" readonly></td>
										</tr>
									</th:block>
									<th:block th:unless="${(Users.role == 'Regular' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'UnitManager' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'Manager')}">
										<tr>
											<th:block>
												<input type="hidden" th:name="|attendanceList[${start.index}].userId|" th:value="${attendance.userId}">
												<input type="hidden" th:name="|attendanceList[${start.index}].dayOfWeek|"
													th:value="${attendance.dayOfWeek}">
												<input type="hidden" th:name="|attendanceList[${start.index}].attendanceDateS|"
													th:value="${attendance.attendanceDateS}">
											</th:block>
											<td th:text="${#dates.format(attendance.attendanceDate, 'MM/dd')}"></td>
											<!--										<td th:text="${attendance.attendanceDateS}"></td>-->
											<td th:text="${attendance.dayOfWeek}"></td>
											<td>
												<select id="status" th:field="*{attendanceList[__${start.index}__].status}" class="noneBox">
													<option value="12" th:selected="${attendance.status} == '0'">選択してください</option>
													<option th:value="0" th:selected="${attendance.status} == '0'">通常出勤</option>
													<option th:value="1" th:selected="${attendance.status} == '1'">休日</option>
													<option th:value="2" th:selected="${attendance.status} == '2'">祝日</option>
													<option th:value="3" th:selected="${attendance.status} == '3'">遅刻</option>
													<option th:value="4" th:selected="${attendance.status} == '4'">有給</option>
													<option th:value="5" th:selected="${attendance.status} == '5'">欠勤</option>
													<option th:value="6" th:selected="${attendance.status} == '6'">早退</option>
													<option th:value="7" th:selected="${attendance.status} == '7'">時間外勤務</option>
													<option th:value="8" th:selected="${attendance.status} == '8'">振替出勤</option>
													<option th:value="9" th:selected="${attendance.status} == '9'">振替休日</option>
													<option th:value="10" th:selected="${attendance.status} == '10'">代替出勤</option>
													<option th:value="11" th:selected="${attendance.status} == '11'">代替休日</option>
												</select>
											</td>
											<td th:if="${(Users.role == 'Regular' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'UnitManager' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'Manager')}"><input type="text" id="startTime" th:field="*{attendanceList[__${start.index}__].startTime}"th:value="${attendance.startTime}" class="noneBox">
											
												<div class="text-danger">
													<div th:if="${#fields.hasErrors('attendanceList[__${start.index}__].startTime')}"
														th:errors="*{attendanceList[__${start.index}__].startTime}"></div>
												</div>
											</td>
											<td><input type="text" id="endTime" th:field="*{attendanceList[__${start.index}__].endTime}"th:value="${attendance.endTime}" class="noneBox">
											
												<div class="text-danger">
													<div th:if="${#fields.hasErrors('attendanceList[__${start.index}__].endTime')}"
														th:errors="*{attendanceList[__${start.index}__].endTime}"></div>
												</div>
											</td>
											
											<td><input type="text" id="attendanceRemarks" th:field="*{attendanceList[__${start.index}__].attendanceRemarks}"th:value="${attendance.attendanceRemarks}" class="noneBox">
											
												<div class="text-danger">
													<div th:if="${#fields.hasErrors('attendanceList[__${start.index}__].attendanceRemarks')}"
														th:errors="*{attendanceList[__${start.index}__].attendanceRemarks}"></div>
												</div>
											</td>
										</tr>
									</th:block>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
 
</body>
</html>















<!--<!DOCTYPE html>-->
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <title>Attendance Registration</title>-->
<!--    <script>-->
<!--        function showPopup() {-->
<!--            alert("登録が完了しました！");-->
<!--        }-->
<!--    </script>-->
<!--</head>-->
<!--<body>-->
<!--    <form action="#" th:action="@{/management}" th:object="${attendanceFormList}" method="post" onsubmit="showPopup()">-->
<!--        <div th:each="attendance, iterStat : ${attendanceFormList.attendanceList}">-->
<!--            <div>-->
<!--                <label for="attendanceRemarks">備考欄:</label>-->
<!--                <input type="text" th:field="*{attendanceList[__${iterStat.index}__].attendanceRemarks}" />-->
<!--                <div th:if="${#fields.hasErrors('attendanceList[' + iterStat.index + '].attendanceRemarks')}" th:errors="*{attendanceList[__${iterStat.index}__].attendanceRemarks}">エラーメッセージ</div>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label for="startTime">出勤時間:</label>-->
<!--                <input type="text" th:field="*{attendanceList[__${iterStat.index}__].startTime}" />-->
<!--                <div th:if="${#fields.hasErrors('attendanceList[' + iterStat.index + '].startTime')}" th:errors="*{attendanceList[__${iterStat.index}__].startTime}">エラーメッセージ</div>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label for="endTime">退勤時間:</label>-->
<!--                <input type="text" th:field="*{attendanceList[__${iterStat.index}__].endTime}" />-->
<!--                <div th:if="${#fields.hasErrors('attendanceList[' + iterStat.index + '].endTime')}" th:errors="*{attendanceList[__${iterStat.index}__].endTime}">エラーメッセージ</div>-->
<!--            </div>-->
<!--        </div>-->
<!--        <button type="submit">登録</button>-->
<!--    </form>-->
<!--</body>-->
<!--</html>-->