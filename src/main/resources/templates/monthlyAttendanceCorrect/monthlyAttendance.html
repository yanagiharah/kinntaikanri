<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>月次勤怠変更処理</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
		rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" 
		crossorigin="anonymous">
	<link th:href="@{/CSS/create.css}" rel="stylesheet" />
</head>
<body>
	<div class="container" th:object="${Users}">	
		<div class="concontainer" th:object="${Users}">
			<form id="mainForm" th:action="@{/attendanceCorrect/management}" method="post" th:object="${attendanceFormList}">
				<div class ="row">
					<div class="col-3" >
					</div>
					<div class="col-4 ">
						ユーザー名:<span th:text="${Users.userName}"></span>
						<input type="hidden" name="userName" th:value="${Users.userName}">
					</div>
					<div class="col-4">
						ユーザーID:<span th:text="${Users.userId}"></span>
						<input type="hidden" name="userId" th:value="${Users.userId}">
					</div>
				</div>
				<div class="row">
	<!--					ユーザー名、訂正申請、戻るボタンを同じ行に表示-->
					<div class="row m-4" >
	<!--						ユーザー名を表示-->
					    <div class="col-3">
							ユーザー名:
							<span th:text="${Users.userName}"></span>
						</div>
						<div class="col-3"　th:unless="${Users.role=='Manager'}">
							<th:block th:switch="${Users.status}">
									ステータス:
									<th:block th:case="null">　</th:block>
									<th:block th:case="1">　承認待ち</th:block>
									<th:block th:case="2">　承認済み</th:block>
									<th:block th:case="3">　却下</th:block>
									<th:block th:case="4">　未申請</th:block>
							</th:block>
						</div>		
						<div class="col-3">
							<div th:if="${Users.role=='Manager'}">
								<input type="submit" id="approve" value="承認" name="approval"class="buttonSize" style="color:lightblue;">
								<input type="submit" id="reject" value="却下" name="rejected"class="buttonSize"　style="color:red;">
							</div>
							<div th:unless="${Users.role=='Manager'}">
								<input type="submit" id="willCorrect" value="訂正申請" name="back" class="buttonSize "th:attr="disabled=${Users.status} != 2"></input>
							</div>
						</div>
						
						<div class="col-3">
							<input type="submit" id="back" value="戻る" name="back" class="buttonSize "></input>
						</div>
					</div>
					<div class="row m-4">
<!--						ユーザーID、テキストボックスのタイトル（変更理由）を同じ行に表示-->
						<div class="col-6">
							ユーザーID:
							<span th:text="${Users.userId}"></span>
						</div>
<!--						変更理由、却下理由それぞれMG画面、RGUM画面で値がない時に非表示かつあるときは読み取り専用（readonly）にしたい-->
						<div  class="col-3">
							変更理由
						</div>	
						<div  class="col-3" th:if="${Users.role=='Manager'}">
							却下理由
						</div>	
					</div>
					<div class="row m-4">
<!--						対象月、カレンダー、テキストボックスを同じ行に表示-->
							<div class="text-danger" th:if="${check} != null">
								<span th:text="${check}" style="color: red;"></span>
							</div>
							<div class="col-6">
								表示年月：
								<input type="month" name="stringYearsMonth" id="stringYearsMonth"
									th:value="${attendanceFormList != null? attendanceFormList.stringYearsMonth: ''}" 
									required min="1800-01"max="2400-12">
								<input type="submit" id="display" value="表示" name="search" class="buttonSize">
							</div>
						<div class="col-6">
							<div th:unless="${Users.role=='Manager'}">
								<textarea name="willCorrectReason" class="m-0"style="height:80px; width:250px;"></textarea>
							</div>
							<div th:if="${Users.role=='Manager'}">
								<textarea name="willCorrectReason" class="m-0"style="height:80px; width:250px;" value="理由を取り込むメソッドをここに入れる"readonly></textarea>
								<textarea name="rejectReason" class="m-0"style="height:80px; width:250px;"></textarea>
							</div>
						</div>
					</div>
				</div>
			</div>
					<!--マネージャー画面-->
			
		<!--						ユーザー選択-->
		<!--バリュー一回無視しているため変更必要-->
			<div th:if="${ApprovalPending} != null"><!--マネージャー画面でない限りnull-->
				<div class="row m-2">
					<div class="col-7">
						<table class="table table-bordered border border-dark ">
							<thead>
								<tr>
									<td>申請者ID</td>
									<td>訂正申請者</td>
									<td>申請対象年月</td>
									<td>申請日</td>
								</tr>
							</thead>
							<tbody >
								<tr th:each="ApprovalPending : ${ApprovalPending}">
									<td>
		<!--											ここでクリックした名前を下のhiddenを要素にして引き出す。-->
										<form th:action="@{/attendance/management}" method="post">
											<th:block>
												<input type="hidden" name="approvalUserId" th:value="${ApprovalPending.userId}">
												<input type="hidden" name="Years" th:value="${ApprovalPending.years}">
												<input type="hidden" name="Month" th:value="${ApprovalPending.month}">
											</th:block>
		<!--														以上の要素がattendanceSerchUpメソッドの引数となる-->
											<button type="submit" name="ApprovalApplicantDisplay" class="linklike"> [[${ApprovalPending.userName}]]</button>
										</form>
									</td>
		<!--												申請対象年月-->
									<td th:text="${#dates.format(ApprovalPending.targetYearMonth,'yyyy/MM/dd')}"></td>
		<!--												申請日-->
									<td th:text="${#dates.format(ApprovalPending.monthlyAttendanceReqDate,'yyyy/MM/dd')}"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			
			<div th:if="${attendanceFormList} != null">
				<div class="row m-2">
					<div class="col-12 ml-3" >
						<div class="text-danger" th:if="${attendanceMessage} != null">
							<span th:text="${attendanceMessage}" style="color: red;"></span>
						</div>
		<!--							エラー吐くのでコメントアウト中			<div class="text-danger">-->
		<!--											<span th:if="${#fields.hasErrors('itemInaccurate')}" th:errors="*{itemInaccurate}"></span>-->
		<!--										</div>-->
						<table class="table table-bordered border border-dark">
							<thead>
								<tr>
									<th>日付</th>
									<th>曜日</th>
									<th>勤務状況</th>
									<th>出勤時間</th>
									<th>退勤時間</th>
									<th>備考</th>
								</tr>
							</thead>
							<!--変更できないようにするのとデータを取り込むようにする-->
							<tbody th:each="attendance, start : ${attendanceFormList.attendanceList}">
									<tr>
										<th:block>
											<input type="hidden" th:name="|attendanceList[${start.index}].userId|" th:value="${attendance.userId}">
											<input type="hidden" th:name="|attendanceList[${start.index}].dayOfWeek|" th:value="${attendance.dayOfWeek}">
											<input type="hidden" th:name="|attendanceList[${start.index}].attendanceDateS|" th:value="${attendance.attendanceDateS}">
										</th:block>

										<td th:text="|${#strings.substring(attendance.attendanceDateS,5,10)}|"></td>
										<td th:text="${attendance.dayOfWeek}"></td>
										<td>
											<select id="status" th:field="*{attendanceList[__${start.index}__].status}" class="noneBox"
											value="理由を取り込むメソッドをここに入れる"readonly>
												<option th:value="12" th:selected="${attendance.status} == '12'" >選択してください</option>
												<option th:value="0" th:selected="${attendance.status} == '0'" >通常出勤</option>
												<option th:value="1" th:selected="${attendance.status} == '1'" >休日</option>
												<option th:value="2" th:selected="${attendance.status} == '2'" >祝日</option>
												<option th:value="3" th:selected="${attendance.status} == '3'" >遅刻</option>
												<option th:value="4" th:selected="${attendance.status} == '4'" >有給</option>
												<option th:value="5" th:selected="${attendance.status} == '5'" >欠勤</option>
												<option th:value="6" th:selected="${attendance.status} == '6'" >早退</option>
												<option th:value="7" th:selected="${attendance.status} == '7'" >時間外勤務</option>
												<option th:value="8" th:selected="${attendance.status} == '8'" >振替出勤</option>
												<option th:value="9" th:selected="${attendance.status} == '9'" >振替休日</option>
												<option th:value="10" th:selected="${attendance.status} == '10'" >代替出勤</option>
												<option th:value="11" th:selected="${attendance.status} == '11'" >代替休日</option>
											</select>
											</td>
											<td><input type="text" id="startTime" th:field="*{attendanceList[__${start.index}__].startTime}"
													th:value="${attendance.startTime}" class="noneBox"
													th:disabled="${(Users.role == 'Regular' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'UnitManager' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'Manager')}">
												<div th:if="${#fields.hasErrors('attendanceList[__${start.index}__].startTime')}" class="text-danger"
													th:errors="*{attendanceList[__${start.index}__].startTime}">
												</div>
											</td>
										<td><input type="text" id="endTime" th:field="*{attendanceList[__${start.index}__].endTime}"
												th:value="${attendance.endTime}" class="noneBox"
												th:disabled="${(Users.role == 'Regular' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'UnitManager' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'Manager')}">
											<div th:if="${#fields.hasErrors('attendanceList[__${start.index}__].endTime')}" class="text-danger"
												th:errors="*{attendanceList[__${start.index}__].endTime}">
											</div>
										</td>
										<td><input type="text" id="attendanceRemarks" th:field="*{attendanceList[__${start.index}__].attendanceRemarks}"
												th:value="${attendance.attendanceRemarks}" class="noneBox"
												th:disabled="${(Users.role == 'Regular' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'UnitManager' and (Users.status == 1 or Users.status == 2)) or (Users.role == 'Manager')}">
											<div th:if="${#fields.hasErrors('attendanceList[__${start.index}__].attendanceRemarks')}" class="text-danger"
												th:errors="*{attendanceList[__${start.index}__].attendanceRemarks}">
											</div>
										</td>
									</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>